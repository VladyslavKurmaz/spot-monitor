FROM nginx:1.13.5

ARG COMPOSE_PROJECT_NAME
ARG LB_STATIC_DASHBOARD_NAME
ARG LB_STATIC_DASHBOARD_NUM
ARG LB_SERVICES_API_NAME
ARG LB_SERVICES_API_NUM
ARG STATIC_DASHBOARD_PORT
ARG STATIC_DASHBOARD_PORTS
ARG SERVICES_API_PORT

ENV COMPOSE_PROJECT_NAME $COMPOSE_PROJECT_NAME
ENV LB_STATIC_DASHBOARD_NAME $LB_STATIC_DASHBOARD_NAME
ENV LB_STATIC_DASHBOARD_NUM $LB_STATIC_DASHBOARD_NUM
ENV LB_SERVICES_API_NAME $LB_SERVICES_API_NAME
ENV LB_SERVICES_API_NUM $LB_SERVICES_API_NUM
ENV STATIC_DASHBOARD_PORT $STATIC_DASHBOARD_PORT
ENV STATIC_DASHBOARD_PORTS $STATIC_DASHBOARD_PORTS
ENV SERVICES_API_PORT $SERVICES_API_PORT


COPY ./nginx.conf.template /nginx.conf
COPY ./configure.sh /configure.sh
RUN /configure.sh
RUN cp /nginx.conf /etc/nginx/nginx.conf


