{
  "env": {
  },
  "stages":{
    "cleanup":{
      "command":"docker volume rm $(docker volume ls -qf dangling=true)"
    },
    "prereq":{
      "script":[
        "npm install -g @angular/cli",
        "apr-get -y install python-jsonschema python-requests"
      ]
    },
    "up":{
      "script":[
"export $(cat ./.env | grep -v ^# | xargs)",
"pushd services/api",
"export API_ARTIFACT=$(mvn -q -Dexec.executable='echo' -Dexec.args='${project.artifactId}-${project.version}-jar-with-dependencies.${project.packaging}' --non-recursive org.codehaus.mojo:exec-maven-plugin:1.3.1:exec)",
"popd",
"docker-compose up $1 --scale $LB_STATIC_WEB_NAME=$LB_STATIC_WEB_NUM --scale $LB_SERVICES_API_NAME=$LB_SERVICES_API_NUM"
      ]
    },
    "stop":{
      "command":"docker-compose stop"
    },
    "down":{
      "command":"docker-compose down --rmi all"
    }
  },
  "components":[
    {
      "id":"services",
      "components":[
        {
          "id":"api",
          "inherits":["java/maven"],
          "stages":{
            "build":{},
            "exec":{}
          }
        },
        {
          "id":"accumulator",
          "subtree":"https://github.com/project-talan/tln-grizzly-jersey.git",
          "inherits":["java/maven"],
          "stages":{
            "build":{},
            "exec":{}
          }
        }
      ]
    },
    {
      "id":"static",
      "components":[
        {
          "id":"dashboard",
          "inherits":["angular"],
          "stages":{
            "install":{
              "command":"npm install"
            },
            "build":{},
            "serve":{
              "command":"ng serve --host 0.0.0.0 --port 4201"
            }
          }
        }
      ]
    }
  ]
}